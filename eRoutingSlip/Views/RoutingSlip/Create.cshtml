@model eRoutingSlip.Models.RoutingSlip
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
@{
    ViewBag.Title = "Create";
}


<div class="container mt-3">
    <h3>File a Routing Slip</h3>

    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        <div class="form-horizontal">
            <hr />
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="row">

                <div class="col">
                    <div class="row ml-1">
                        <div class="form-group">
                            @*@Html.LabelFor(model => model.DocumentName, htmlAttributes: new { @class = "control-label" })*@
                            Document Link
                            @Html.ValidationMessageFor(model => model.DocumentName, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="row ml-1">
                            @Html.EditorFor(model => model.DocumentName, new { htmlAttributes = new { @class = "form-control", @id = "docTitle", autofocus = "" } })

                        <div class="col-2"><input type="button" id="setTitle" value=&#10003 class="btn btn-default" onclick="SetTitle();" /></div>
                    </div>

                    <!--Start copy-->
                    <div class="row mt-3">
                        <div class="form-group">
                            @Html.LabelFor(model => model.ForwardTo, "Recipients:", htmlAttributes: new { @class = "control-label ml-3" })
                            @Html.ValidationMessageFor(model => model.ForwardTo, "", new { @class = "text-danger visible" })
                            @Html.EditorFor(model => model.ForwardTo, new { htmlAttributes = new { @class = "form-control d-none", @id = "forwardTo" } })
                        </div>
                    </div>


                    <div class="row pb-5">
                        <div class="col-7"><input type="text" class="form-control inputfield" id="input0" disabled /></div>
                        <div><input id="addEmail" type="button" value="Add" class="btn btn-default" onclick="SendList();" disabled /></div>
                    </div>

                    <!--end copy-->

                    <div class="row mt-lg-5 ml-1">
                        <div class="form-group">
                            <input type="submit" id="createRS" value="Create" class="btn btn-default" disabled />
                            <input type="button" id="clearFields" value="Reset Form" class="btn btn-default]ml-2" onclick="ClearFields();" disabled />
                        </div>
                    </div>
                </div>
                <div class="col">
                    Route List

                    <div class="row h-75 " >
                        <div class="col-9  h-100 ml-3 mt-3 form-control" id="SendList" style="overflow-y: scroll;">
                        </div>
                    </div>

                </div>


            </div>
        </div>
    }


</div>

<script>


    var usrName = "@HttpContext.Current.User.Identity.Name";

    @*var cache = {};
    $("#input0").autocomplete({
        minLength: 2,
        mustMatch: true,
        focus: function (event, ui) {
            //ui.item.label contains value
            return false;
        },
        change: function (event, ui) {
            if (!ui.item) {
                $("#input0").focus();
                $("#input0").val("");


            }

        },
        select: function (event, ui) {
            var val = ui.item.value;
            return false;
        },
        source: function (request, response) {
            var term = request.term;
            if (term in cache) {
                response(cache[term]);
                return;
            }
            $.ajax({
                url: '@Url.Action("GetSearchValue","RoutingSlip")',
                dataType: "json",
                data: { search: $("#input0").val() },
                success: function (data) {
                    response($.map(data, function (item) {
                        return{ label: item.Email, value: item.Email };
                    }));
                },
                error: function (xhr, status, error) {
                    alert("Error")
                }
            });
        }
    });*@
   

    $("#input0").autocomplete({
        source: function (request, response) {
            $.ajax({
                url: '@Url.Action("GetSearchValue","RoutingSlip")',
                dataType: "json",
                data: { search: $("#input0").val() },
                success: function (data) {
                    response($.map(data, function (item) {
                        return{ label: item.Email, value: item.Email };
                    }));
                },
                error: function (xhr, status, error) {
                    alert("Error")
                }
            });
        }
    });

    function SetTitle() {
        var x = document.getElementById("docTitle");
        x.readOnly = true;
        x = document.getElementById("setTitle");
        x.disabled = true;
        x = document.getElementById("clearFields");
        x.disabled = false;
        x = document.getElementById("addEmail");
        x.disabled = false;
        x = document.getElementById("input0");
        x.disabled = false;
        x.focus();
    }

    function SendList() {
        var x = document.getElementById("createRS");
        x.disabled = false;
        var e = $("#input0").val();
        var em;
        var f = $("#forwardTo").val();

        if (e == '') {
            alert('Enter e-mail');
        }
        else {
            if (f.includes(e)) {
                alert('This e-mail is currently in the list');
            }
            else if (e == usrName) {
                alert('Unable to add current user to list.');
            }
            else {
                em = e + ",";
                f = f + em;

                $("#forwardTo").val(f);
                var newDiv = document.createElement("p");
                newDiv.setAttribute("class", "mt-2");

                var emailInput;

                emailInput = document.createTextNode($("#input0").val());

                var removeEntry = document.createElement("BUTTON");

                removeEntry.setAttribute("class", "btn btn-default  ml-5 badge-danger badge-pill badge float-right");
                removeEntry.setAttribute("type", "button");
                removeEntry.setAttribute("id", em);
                removeEntry.setAttribute("onclick", "Rem(this.id);");
                var t = document.createTextNode("-");
                removeEntry.appendChild(t);

                newDiv.appendChild(emailInput); //textnode
                newDiv.appendChild(removeEntry);
                document.getElementById("SendList").appendChild(newDiv);
                document.getElementById("input0").value = '';
            }
        }
        x = document.getElementById("input0");
        x.focus();
    }

    function Rem(a) {

        var x = document.getElementById(a);
        x.parentNode.remove();

        var f = $("#forwardTo").val();
        f = f.replace(a, "");
        $("#forwardTo").val(f);

        x = document.getElementById("SendList").childElementCount;
        if (x == 0) {
            var y = document.getElementById("createRS");
            y.disabled = true;
        }
        x = document.getElementById("input0");
        x.focus();

    }
</script>
